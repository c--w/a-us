"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.getArguments = void 0;
const path_1 = __importDefault(require("path"));
const os_1 = __importDefault(require("os"));
function getArguments() {
    const argv = require('minimist')(process.argv.slice(2));
    const packageJson = require(__dirname + "/../package.json");
    if (argv.help) {
        console.log(`${packageJson.name} v${packageJson.version}

Options:
    --endpoint: WebSocket endpoint for all connections (default: ws://localhost:2567)
    --room: room handler name
    --numClients: number of connections to open
    [--delay]: delay to start each connection (in milliseconds)
    [--project]: specify a tsconfig.json file path
    [--threads]: number of threads to distribute clients

Example:
    colyseus-loadtest example/bot.ts --endpoint ws://localhost:2567 --room state_handler`);
        process.exit();
    }
    const endpoint = argv.endpoint || `ws://localhost:2567`;
    const roomName = argv.room;
    const scriptFile = path_1.default.resolve(argv._[0]);
    const delay = argv.delay || 0;
    // Distribute provided numClients to threads
    const threads = (argv.threads === 'all')
        ? os_1.default.cpus().length
        : argv.threads || 1;
    const numClients = Math.max(1, Math.ceil((argv.numClients || 1) / threads));
    if (!scriptFile) {
        console.error("you must specify a scripting file.");
        process.exit();
    }
    const scripting = require(scriptFile);
    if (!roomName) {
        console.error("--room options is required.");
        process.exit();
    }
    return {
        endpoint,
        roomName,
        numClients,
        delay,
        scripting,
        threads,
    };
}
exports.getArguments = getArguments;
